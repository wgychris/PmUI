<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="images/PieceMaker.jpg">

<title>PieceMaker</title>
<link
	href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,400italic,700,800'
	rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway:300,200,100'
	rel='stylesheet' type='text/css'>

<!-- Bootstrap core CSS -->
<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.switch/bootstrap-switch.min.css" />
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />

<!-- Select2 -->
<link rel="stylesheet" type="text/css"
	href="js/jquery.select2/select2.css" />


<!-- Slider -->
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.slider/css/slider.css" />

<!-- DateRange -->
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.daterangepicker/daterangepicker-bs3.css" />

<!-- Custom styles for this template -->
<link href="css/style.css" rel="stylesheet" />

<link rel="stylesheet"
	href="fonts/font-awesome-4/css/font-awesome.min.css">
<link rel="stylesheet" href="css/pygments.css">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <![endif]-->

<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

</head>

<body>

	<!-- Fixed navbar -->
	<div id="head-nav" class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="fa fa-gear"></span>
				</button>
				<a class="navbar-brand" href="#">&nbsp<span>PieceMaker</span></a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li><a href="anaTotRev.html">Home</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right user-nav">
					<li><a href="#">Dashboard</a></li>
				</ul>

			</div>
			<!--/.nav-collapse -->
		</div>
	</div>


	<div id="cl-wrapper">
		<div class="cl-sidebar">
			<div class="cl-toggle">
				<i class="fa fa-bars"></i>
			</div>
			<div class="cl-navblock">
				<div class="menu-space">
					<div class="content">
						<div class="side-user">
							<div class="info">
								<a href="#">Piecemaker Analytics</a>
							</div>
						</div>
						<ul class="cl-vnavigation">

							<li><a href="#"><i class="fa fa-money"></i><span>Revenue
								</span></a>
								<ul class="sub-menu">
									<li><a href="anaTotRev.html">Total Revenue</a></li>
									<li><a href="anaRevPerCat.html">Revenue Per Category</a></li>
								</ul></li>

							<li><a href="anaCBTPer.html"><i class="fa fa-eye"></i><span>Customer
										Behaviour </span></a>
							</li>

							<li><a href="#"><i class="fa fa-smile-o"></i><span>Popularity</span></a>
								<ul class="sub-menu">
									<li><a href="anaPopPiece.html">Popularity of Piece</a></li>
									<li class="active"><a href="anaPopCus.html">Popularity of
											Customization</a></li>
								</ul></li>
							<li><a href="anaCusInfo.html"><i class="fa fa-table"></i><span>Customer
										Info</span></a></li>
							<li><a href="anaPriSta.html"><i class="fa fa-bar-chart-o"></i><span>Print
										Station Analysis</span></a></li>
						</ul>
					</div>
				</div>
				
				<div class="text-right collapse-button" style="padding: 7px 9px;">
					<button id="sidebar-collapse" class="btn btn-default" style="">
						<i style="color: #fff;" class="fa fa-angle-left"></i>
					</button>
				</div>
				
			</div>
		</div>


		<div class="container-fluid" id="pcont">
			<div class="page-head">
				<ol class="breadcrumb">
					<li><a href="#">Home</a></li>
					<li><a href="#">Customer Behavior Analytics</a></li>
					<li class="active">Popularity of Color Option</li>
				</ol>
			</div>


			<div class="cl-mcont">
				<div class="row">
					<div class="col-sm-12 col-md-12">
						<div class="form-group">
								
							</div>
							
							<div class="form-group">
								<label class="col-sm-2 control-label">Date & Time Picker</label>
								<div class="col-sm-4">
									<div id="reportrange" class="pull-left"
										style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
										<i class="glyphicon glyphicon-calendar fa fa-calendar"></i> <span></span>
										<b class="caret"></b>
									</div>
								</div>
							</div>
							
						<div class="form-group">
							<label class="col-sm-2 control-label"></label>
								<label class="col-sm-1 control-label">Select</label>
								<div class="col-sm-3">
									
									<select class="form-control" 
									style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc" onChange="selectPopularityChange()" id="selectPopularityOpt">
									<option>Daily Popularity</option>
									<option>Weekly Popularity</option>
									<option>Monthly Popularity</option>
									<option>Annually Popularity</option>
								</select>
								</div>
							</div>

							<br> <br> 
					
					
						<div id="colorPop"></div>
					</div>

				</div>
			</div>
			
			
			<div class="col-sm-12 col-md-12">
				<div class="col-sm-6 col-md-6">
					<div class="form-group">
						<label class="col-sm-4 control-label">Select Category</label>
						<div class="col-sm-5">
							<select id = "selectCate" class="form-control" onChange="selectCategoryChange()">
							</select>
						</div>
					</div>
					<br> <br>
					<div class="block-flat">
						<div id="poppie"
							style="height: 350px; padding: 0px; position: relative;"></div>
					</div>
				</div>
			
			


				<div class="col-sm-6 col-md-6">
					<div class="form-group">
						<label class="col-sm-4 control-label">Select Piece</label>
						<div class="col-sm-5">
							<select class="select2" onChange="selectPieceChange()" id="selectPieceOpt">
								
							</select>
						</div>
					</div>
					<br> <br>
					<div class="block-flat">
						<div id="ColorPiece"
							style="height: 350px; padding: 0px; position: relative;"></div>
					</div>
				</div>
			</div>
		


		</div>
	</div>

	<script
		src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>

	<script type="text/javascript"
		src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
	<script type="text/javascript"
		src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
	<script type="text/javascript"
		src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
	<script type="text/javascript" src="js/behaviour/general.js"></script>
	<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
	<script type="text/javascript"
		src="js/jquery.nestable/jquery.nestable.js"></script>
	<script type="text/javascript"
		src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
	<script type="text/javascript"
		src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
	<script src="js/bootstrap.slider/js/bootstrap-slider.js"
		type="text/javascript"></script>
	<script type="text/javascript"
		src="js/jquery.gritter/js/jquery.gritter.js"></script>
		<script type="text/javascript"
			src="js/bootstrap.daterangepicker/moment.min.js"></script>
		<script type="text/javascript"
			src="js/bootstrap.daterangepicker/daterangepicker.js"></script>

	<script type = "text/javascript">
			var startDate;
			var endDate;
			var optionsPie;
			var optionPiece;
			var options;
			var selectedStr;
			var selePiece;
	</script>
		
	<script type="text/javascript">
		$(document).ready(function() {
			//initialize the javascript
			App.init();
			App.charts();
		});
		
		
	</script>

	<script type="text/javascript">
		$(function() {
			$.getJSON("./getCategory.php", function(result) {
				for (var i in result) {
					$("#selectCate").append('<option value="' + result[i] + '">' + result[i] + '</option>');
				}
			});				
			
			$.getJSON("./getPieceListByCategory.php", function(result) {
				for (var i in result) {

					/*  console.log(result[i].category);  */
					$("#selectPieceOpt").append('<optgroup label=\''+result[i].category+'\' id=\'categoryGroup'+i+'\'></optgroup>');
					
					for (var j in result[i].piece) {
						$("#categoryGroup"+i).append('<option value="' + result[i].piece[j] + '">' + result[i].piece[j] + '</option>');
					}
				}
			});	 
		});
	</script>
	
	
	<script>
		$(function() {
			// build Piece bar chart
			optionPiece = {
		chart: {
			type: 'column',
			renderTo: 'ColorPiece'
            
        },
        title : {
			text : 'Color Option for Piece'
		},
		xAxis : {
			categories : ["Purple","Yellow"]
		},
		yAxis : {
			min : 0,
			title : {
				text : 'Number'
			}
		},
		legend : {
			enabled : false
		},
		tooltip : {
			pointFormat : 'Num: <b>{point.y:.1f}</b>',
		},
        series: [{	
			name : 'Color',
			data : []
			}]
		};
		//	var piece = document.getElementById("selectPieceOpt").options[0].value;
			var url = "./pieceColor.php?pieceName=Gyro";
			if (startDate != null && endDate != null) {
		  		url = url + "&startDate="+startDate+"&endDate="+endDate	;	
		  	}
			$.getJSON(url, function(json) {
				optionPiece.xAxis.categories = json.colorNames;
				optionPiece.series[0].data = json.colorNum;
		        chart = new Highcharts.Chart(optionPiece);
		    });
	});	
			
			
		$(function() {	
			// Build the pie chart
		 optionsPie = {
				chart : {
					renderTo : 'poppie',
					type : 'pie',
					plotBackgroundColor : null,
					plotBorderWidth : null,
					plotShadow : false
				},
				title : {
					text : 'Color Option for Category'
				},
				tooltip : {
					pointFormat : '{series.name}: <b>{point.percentage:.1f}%</b>'
				},
				plotOptions : {
					series : {
						allowPointSelect : true,
						cursor : 'pointer',
						dataLabels : {
							enabled : true,
							format : '<b>{point.name}</b>: {point.percentage:.2f} %',
							style : {
								color : (Highcharts.theme && Highcharts.theme.contrastTextColor)
										|| 'black'
							}
						}
					}
				},
				series : [ {
					type : 'pie',
					name : 'Color',
					data : []
				} ]
			};
			var url = "./getColor.php?category=Jewelry: Pendants With Stencil";
			if (startDate != null && endDate != null) {
				url = url + "?startDate="+startDate+"&endDate="+endDate;
			}
			$.getJSON(url, function(result) {
				optionsPie.series[0].data = result.data;
				Highcharts.getOptions().plotOptions.pie.colors = result.color;
				chart = new Highcharts.Chart(optionsPie);
			});
			
			// 求改颜色！！！！
			
	/* 		// Make monochrome colors and set them as default for all pies
			Highcharts.getOptions().plotOptions.pie.colors = (function() {
				var colors = [], base = Highcharts.getOptions().colors[0], i

				for (i = 0; i < 10; i++) {
					// Start out with a darkened base color (negative brighten), and end
					// up with a much brighter color
					colors.push(Highcharts.Color(base).brighten((i - 3) / 7)
							.get());
				}
				return colors;
			}()); */

			
		});
		
		// build big color populariy bar chart
		$(function() {
			options = {
					chart : {
						type : 'column',
						renderTo: 'colorPop'
					},
					title : {
						text : 'Popularity of color option'
					},
					xAxis : {
						categories : [ '07-15-14', '07-16-14',
								'07-17-14', '07-18-14', '07-19-14',
								'07-20-14', '07-21-14' ]
					},
					yAxis : {
						min : 0,
						title : {
							text : 'Total fruit consumption'
						},
						stackLabels : {
							enabled : true,
							style : {
								fontWeight : 'bold',
								color : (Highcharts.theme && Highcharts.theme.textColor)
										|| 'gray'
							}
						}
					},
					legend : {
						align : 'right',
						x : -70,
						verticalAlign : 'top',
						y : 20,
						floating : true,
						backgroundColor : (Highcharts.theme && Highcharts.theme.background2)
								|| 'white',
						borderColor : '#CCC',
						borderWidth : 1,
						shadow : false
					},
					tooltip : {
						formatter : function() {
							return '<b>' + this.x + '</b><br/>'
									+ this.series.name + ': '
									+ this.y + '<br/>' + 'Total: '
									+ this.point.stackTotal;
						}
					},
					plotOptions : {
						column : {
							stacking : 'normal',
							dataLabels : {
								enabled : true,
								color : (Highcharts.theme && Highcharts.theme.dataLabelsColor)
										|| 'white',
								style : {
									textShadow : '0 0 3px black, 0 0 3px black'
								}
							}
						}
					},
					series: []

			};
			var url = "./color.php";
			/* if (startDate != null && endDate != null) {
				  		url = url + "?startDate="+startDate+"&endDate="+endDate	;	
				  } */
			$.getJSON(url, function(json) {
				options.xAxis.categories = json.dateArr;
	            options.series = json.colors;
	            chart = new Highcharts.Chart(options);
	        });
		});
	</script>
		
	<script>
		function selectCategoryChange() {
			var myselect = document.getElementById("selectCate");
			selectedStr = myselect.options[myselect.selectedIndex].value;
			refreshPieGraph (startDate,endDate,selectedStr);
		}
		
		
		function selectPopularityChange() {
			  var myselect = document.getElementById("selectPopularityOpt");
			  var option = myselect.options[myselect.selectedIndex].label;
			  switch (option) {
			  case 'Weekly Popularity': 
				  var url = "./colorWeeklyData.php";
				  if (startDate != null && endDate != null) {
				  		url = url + "?startDate="+startDate+"&endDate="+endDate	;	
				  }
				  $.getJSON(url, function(json) {
					  options.xAxis.categories = json.dateArr;
			            options.series = json.colors;
			            chart = new Highcharts.Chart(options);
	            }); break;
			  case 'Monthly Popularity': 
				  var url = "./colorMonthlyData.php";
				  if (startDate != null && endDate != null) {
				  		url = url + "?startDate="+startDate+"&endDate="+endDate	;	
				  }
				  $.getJSON(url, function(json) {
					  options.xAxis.categories = json.dateArr;
			            options.series = json.colors;
			            chart = new Highcharts.Chart(options);
	            }); break;
			  case 'Annually Popularity': 
				  var url = "./colorAnnuallyData.php";
				  if (startDate != null && endDate != null) {
				  		url = url + "?startDate="+startDate+"&endDate="+endDate	;	
				  }
				  $.getJSON(url, function(json) {
					  options.xAxis.categories = json.dateArr;
			            options.series = json.colors;
			            chart = new Highcharts.Chart(options);
	            }); break;
			  case 'Daily Popularity':
				  var url = "./color.php";
				  if (startDate != null && endDate != null) {
				  		url = url + "?startDate="+startDate+"&endDate="+endDate	;	
				  }
				  $.getJSON(url, function(json) {
					  options.xAxis.categories = json.dateArr;
			            options.series = json.colors;
			            chart = new Highcharts.Chart(options);
	            }); break;
			  }
		}
	</script>
	
	<script type="text/javascript">
	function refreshPieGraph (startDate,endDate,pieceName) {
		var url = "./getColor.php?category=" + selectedStr;
		if (startDate != null && endDate != null) {
	  		url = url + "&startDate="+startDate+"&endDate="+endDate	;	
	  	}
		$.getJSON(url, function(result) {
			optionsPie.series[0].data = result.data;
			Highcharts.getOptions().plotOptions.pie.colors = result.color;
			chart = new Highcharts.Chart(optionsPie);
		});
	}
	</script>
	
	<script>
	function selectPieceChange() {
		var myselect = document.getElementById("selectPieceOpt");
		  selePiece = myselect.options[myselect.selectedIndex].label;
		  refreshPieceGraph(startDate, endDate, selePiece);
		  /* refreshGraph(option); */
	}
	</script>
	
			
	<script>
	// mengdi ~*********  要改
	function refreshPieceGraph (startDate,endDate,pieceName)
	{
		var url = "./pieceColor.php?pieceName="+pieceName;
		if (startDate != null && endDate != null) {
	  		url = url + "&startDate="+startDate+"&endDate="+endDate	;	
	  	}
		$.getJSON(url, function(json) {
			optionPiece.xAxis.categories = json.colorNames;
			optionPiece.series[0].data = json.colorNum;
	        chart = new Highcharts.Chart(optionPiece);
	    });	
	}
// ************************************************************//
</script>


<script type="text/javascript">
	$(document)
			.ready(
					function() {
						//initialize the javascript

						$('#reservation').daterangepicker();
						$('#reservationtime').daterangepicker({
							timePicker : true,
							timePickerIncrement : 30,
							format : 'MM/DD/YYYY h:mm A'
						});
						var cb = function(start, end) {
							$('#reportrange span')
									.html(
											start
													.format('MMMM D, YYYY')
													+ ' - '
													+ end
															.format('MMMM D, YYYY'));
							
							/* refreshGraph(start.format('YYYY-MM-DD'), end.format('YYYY-MM-DD')); */
							startDate = start.format('YYYY-MM-DD');
							endDate = end.format('YYYY-MM-DD');
							selectPopularityChange();
						};

						var optionSet1 = {
							startDate : moment().subtract('days', 29),
							endDate : moment(),
							minDate : '01/01/2012',
							maxDate : '12/31/2014',
							dateLimit : {
								days : 60
							},
							showDropdowns : true,
							showWeekNumbers : true,
							timePicker : false,
							timePickerIncrement : 1,
							timePicker12Hour : true,
							opens : 'left',
							buttonClasses : [ 'btn' ],
							applyClass : 'btn-small btn-primary',
							cancelClass : 'btn-small',
							format : 'MM/DD/YYYY',
							separator : ' to ',
							locale : {
								applyLabel : 'Submit',
								cancelLabel : 'Clear',
								fromLabel : 'From',
								toLabel : 'To',
								customRangeLabel : 'Custom',
								daysOfWeek : [ 'Su', 'Mo', 'Tu', 'We',
										'Th', 'Fr', 'Sa' ],
								monthNames : [ 'January', 'February',
										'March', 'April', 'May',
										'June', 'July', 'August',
										'September', 'October',
										'November', 'December' ],
								firstDay : 1
							}
						};

					
						$('#reportrange span').html(
								moment().subtract('days', 29).format(
										'MMMM D, YYYY')
										+ ' - '
										+ moment().format(
												'MMMM D, YYYY'));

						$('#reportrange').daterangepicker(optionSet1,
								cb);

					});
	
	
	function refreshGraph (startDate,endDate) {
		var url = "./color.php";
		if (startDate != null && endDate != null) {
			  		url = url + "?startDate="+startDate+"&endDate="+endDate	;	
			  }
		$.getJSON(url, function(json) {
			options.xAxis.categories = json.dateArr;
            options.series = json.colors;
            chart = new Highcharts.Chart(options);
        });
		refreshPieGraph (startDate,endDate,selectedStr);
		refreshPieceGraph(startDate, endDate, selePiece);
	}
		
	</script>

	<!-- Bootstrap core JavaScript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="js/behaviour/voice-commands.js"></script>
	<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
	<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
	<script type="text/javascript"
		src="js/jquery.flot/jquery.flot.resize.js"></script>
	<script type="text/javascript"
		src="js/jquery.flot/jquery.flot.labels.js"></script>
</body>
</html>
