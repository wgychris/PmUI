<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="images/PieceMaker.jpg">

<title>PieceMaker</title>
<link
	href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,400italic,700,800'
	rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway:300,200,100'
	rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css"
	href="js/jquery.niftymodals/css/component.css" />
<!-- Bootstrap core CSS -->
<link href="js/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.switch/bootstrap-switch.min.css" />
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />

<!-- Select2 -->
<link rel="stylesheet" type="text/css"
	href="js/jquery.select2/select2.css" />


<!-- Slider -->
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.slider/css/slider.css" />

<!-- DateRange -->
<link rel="stylesheet" type="text/css"
	href="js/bootstrap.daterangepicker/daterangepicker-bs3.css" />

<!-- Custom styles for this template -->
<link href="css/style.css" rel="stylesheet" />

<link rel="stylesheet"
	href="fonts/font-awesome-4/css/font-awesome.min.css">
<link rel="stylesheet" href="css/pygments.css">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <![endif]-->
<link rel="stylesheet" type="text/css"
	href="js/jquery.nanoscroller/nanoscroller.css" />
<link href="js/jquery.icheck/skins/square/blue.css" rel="stylesheet">

</head>

<body>

	<!-- Fixed navbar -->
	<div id="head-nav" class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="fa fa-gear"></span>
				</button>
				<a class="navbar-brand" href="#"><span>PieceMaker</span></a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li><a href="anaTotRev.html">Home</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right user-nav">
					<li><a href="#">Dashboard</a></li>
				</ul>

			</div>
			<!--/.nav-collapse -->
		</div>
	</div>


	<div id="cl-wrapper">
		<div class="cl-sidebar">
			<div class="cl-toggle">
				<i class="fa fa-bars"></i>
			</div>
			<div class="cl-navblock">
				<div class="menu-space">
					<div class="content">
						<div class="side-user">
							<div class="info">
								<a href="#">Piecemaker Analytics</a>
							</div>
						</div>
						<ul class="cl-vnavigation">

							<li><a href="#"><i class="fa fa-money"></i><span>Revenue
								</span></a>
								<ul class="sub-menu">
									<li><a href="anaTotRev.html">Total Revenue</a></li>
									<li><a href="anaRevPerCat.html">Revenue Per Category</a></li>
								</ul></li>

							<li><a href="anaCBTPer.html"><i class="fa fa-eye"></i><span>Customer
										Behaviour </span></a>
							</li>

							<li><a href="#"><i class="fa fa-smile-o"></i><span>Popularity</span></a>
								<ul class="sub-menu">
									<li class="active"><a href="anaPopPiece.html">Popularity of Piece</a></li>
									<li><a href="anaPopCus.html">Popularity of
											Customization</a></li>
								</ul></li>
							<li><a href="anaCusInfo.html"><i class="fa fa-table"></i><span>Customer
										Info</span></a></li>
							<li><a href="anaPriSta.html"><i class="fa fa-bar-chart-o"></i><span>Print
										Station Analysis</span></a></li>
						</ul>
					</div>
				</div>
				
				<div class="text-right collapse-button" style="padding: 7px 9px;">
					<button id="sidebar-collapse" class="btn btn-default" style="">
						<i style="color: #fff;" class="fa fa-angle-left"></i>
					</button>
				</div>
				
			</div>
		</div>


		<div class="container-fluid" id="pcont">
			<div class="page-head">
				<ol class="breadcrumb">
					<li><a href="anaTotRev.html">Home</a></li>
					<li>Popularity</li>
					<li class="active">Popularity of Piece</li>
				</ol>
			</div>


			<div class="cl-mcont">
				<div class="row">
					<div class="col-sm-12 col-md-12">





						<div class="col-sm-3 col-md-3">

							<!-- Nifty Modal -->
							<div class="md-modal colored-header  md-effect-9"
								id="reply-ticket">
								<div class="md-content">
									<div class="modal-header">
										<button type="button" class="close md-close"
											data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">
										<!-- <div id="PopPiece"
								style="height: 350px; padding: 0px; position: relative;"></div>
 -->

									</div>

								</div>
							</div>
							<div class="md-overlay"></div>
						</div>


						<div class="col-sm-12 col-md-12">

							<div class="block-flat">
								<div id="poppie"
									style="height: 350px; padding: 0px; position: relative;"></div>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-1 control-label">Piece</label>
							<div class="col-sm-4">

								<select class="select2"
									onChange="selectPieceChange()" id="selectPieceOpt">
									
								</select>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">Date & Time Picker</label>
							<div class="col-sm-4">
								<div id="reportrange" class="form-control"
									style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
									<i class="glyphicon glyphicon-calendar fa fa-calendar"></i> <span></span>
									<b class="caret"></b>
								</div>
							</div>
						</div>
						
						<div class="col-sm-12 col-md-12">
<br> <br>
							<div class="block-flat">
								<div id="PopPiece"
									style="height: 350px; padding: 0px; position: relative;"></div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
	<script
			src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="http://code.highcharts.com/highcharts.js"></script>
		<script src="http://code.highcharts.com/modules/exporting.js"></script>
		<script type="text/javascript"
			src="js/jquery.nanoscroller/jquery.nanoscroller.js"></script>
		<script type="text/javascript"
			src="js/jquery.sparkline/jquery.sparkline.min.js"></script>
		<script type="text/javascript"
			src="js/jquery.easypiechart/jquery.easy-pie-chart.js"></script>
		<script type="text/javascript" src="js/behaviour/general.js"></script>
		<script src="js/jquery.ui/jquery-ui.js" type="text/javascript"></script>
		<script type="text/javascript"
			src="js/jquery.nestable/jquery.nestable.js"></script>
		<script type="text/javascript"
			src="js/bootstrap.switch/bootstrap-switch.min.js"></script>
		<script type="text/javascript"
			src="js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
		<script src="js/jquery.select2/select2.min.js" type="text/javascript"></script>
		<script src="js/bootstrap.slider/js/bootstrap-slider.js"
			type="text/javascript"></script>
		<script type="text/javascript"
			src="js/jquery.gritter/js/jquery.gritter.js"></script>
		<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
		<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
		<script type="text/javascript"
			src="js/jquery.flot/jquery.flot.resize.js"></script>
		<script type="text/javascript"
			src="js/jquery.flot/jquery.flot.labels.js"></script>
		<script type="text/javascript"
			src="js/bootstrap.daterangepicker/moment.min.js"></script>
		<script type="text/javascript"
			src="js/bootstrap.daterangepicker/daterangepicker.js"></script>
		<script type="text/javascript"
			src="js/jquery.niftymodals/js/jquery.modalEffects.js"></script>
		
		
		<script type = "text/javascript">
			var startDate;
			var endDate;
		</script>
		
		<script type="text/javascript">
			$(document).ready(function() {
				//initialize the javascript
				App.init();
				App.charts();
				
				$.getJSON("./getPieceListByCategory.php", function(result) {
					for (var i in result) {

						/*  console.log(result[i].category);  */
						$("#selectPieceOpt").append('<optgroup label=\''+result[i].category+'\' id=\'categoryGroup'+i+'\'></optgroup>');
						
						for (var j in result[i].piece) {
							$("#categoryGroup"+i).append('<option value="' + result[i].piece[j] + '">' + result[i].piece[j] + '</option>');
						}
					}
				});	 
			});
			
			
			function selectPieceChange() {
				var myselect = document.getElementById("selectPieceOpt");
				  var option = myselect.options[myselect.selectedIndex].label;
				  console.log(option);
				  refreshGraph(option);
			}
		</script>


		<script type="text/javascript">
			var options = {
				chart : {
					renderTo : 'poppie',
					type : 'pie'
				},
				title : {
					text : 'Top 5 Seller'
				},
				plotOptions : {
					series : {

						allowPointSelect : true,
						cursor : 'pointer',
						dataLabels : {
							enabled : true,
							format : '<b>{point.name}</b>:<br>{point.percentage:.2f} %',
							style : {
								color : (Highcharts.theme && Highcharts.theme.contrastTextColor)
										|| 'black'
							}
						},
						point : {
							events : {
								click : function() {
									/* alert(this.name); */
								refreshGraph(this.name);
								}
							}
						} 

					}
				},

				tooltip : {
					pointFormat : '{series.name}: <b>{point.percentage:.1f}%</b>'
				},

				series : [ {
					type : 'pie',
					name : 'Piece Name',
					data : []
				} ],

			};
			
			var url;
			if (startDate != null && endDate != null) {
				url = "./getTop5Piece.php?startDate="+startDate+"&endDate="+endDate;
			}else {
				url = "./getTop5Piece.php";
			}
			
			$.getJSON(url, function(result) {
				options.series[0].data = result;
				chart = new Highcharts.Chart(options);
			});
		</script>
		
		<script>
		
		function refreshGraph(piece){
		 var option = {
				chart : {
					type: 'line',
					renderTo: 'PopPiece'
				},
				title : {
					text : 'Popularity of '+piece,
				},
				xAxis : {
					categories : []
				},
				yAxis : {
					title : {
						text : 'Frenquency(Times)'
					},
					plotLines: [{
		                value: 0,
		                width: 1,
		                color: '#808080'
		            }]
				},
				legend: {
		            layout: 'vertical',
		            align: 'right',
		            verticalAlign: 'middle',
		            borderWidth: 0
		        },
				tooltip : {
					valuePrefix : 'times '
				},
				series : []
			} 
		 	var url = "./getTopPiece.php?piece=" + piece;
		 	if (startDate != null && endDate != null) {
		 		url = url + "&startDate="+startDate+"&endDate="+endDate;
		 	}
			$.getJSON(url, function(result) {
            option.xAxis.categories = result.dateArr;
            option.series = result.data;
            chart = new Highcharts.Chart(option);
        });
		
	}
		</script>


		
		<script type="text/javascript">
			$(document).ready(
					function() {
						//initialize the javascript

						$('#reservation').daterangepicker();
						$('#reservationtime').daterangepicker({
							timePicker : true,
							timePickerIncrement : 30,
							format : 'MM/DD/YYYY h:mm A'
						});
						var cb = function(start, end) {
							$('#reportrange span').html(
									start.format('MMMM D, YYYY') + ' - '
											+ end.format('MMMM D, YYYY'));

							refreshGraphDate(start.format('YYYY-MM-DD'), end
									.format('YYYY-MM-DD'));
							startDate = start.format('YYYY-MM-DD');
							endDate = end.format('YYYY-MM-DD');

						}

						var optionSet1 = {
							startDate : moment().subtract('days', 29),
							endDate : moment(),
							minDate : '01/01/2012',
							maxDate : '12/31/2014',
							dateLimit : {
								days : 60
							},
							showDropdowns : true,
							showWeekNumbers : true,
							timePicker : false,
							timePickerIncrement : 1,
							timePicker12Hour : true,
							opens : 'left',
							buttonClasses : [ 'btn' ],
							applyClass : 'btn-small btn-primary',
							cancelClass : 'btn-small',
							format : 'MM/DD/YYYY',
							separator : ' to ',
							locale : {
								applyLabel : 'Submit',
								cancelLabel : 'Clear',
								fromLabel : 'From',
								toLabel : 'To',
								customRangeLabel : 'Custom',
								daysOfWeek : [ 'Su', 'Mo', 'Tu', 'We', 'Th',
										'Fr', 'Sa' ],
								monthNames : [ 'January', 'February', 'March',
										'April', 'May', 'June', 'July',
										'August', 'September', 'October',
										'November', 'December' ],
								firstDay : 1
							}
						};

						$('#reportrange span').html(
								moment().subtract('days', 29).format(
										'MMMM D, YYYY')
										+ ' - '
										+ moment().format('MMMM D, YYYY'));

						$('#reportrange').daterangepicker(optionSet1, cb);

					});
		</script>
		<script type="text/javascript">
		function refreshGraphDate(startDate, endDate) {
			var url = "./getTop5Piece.php";
			if (startDate != null && endDate != null) {
				url = "./getTop5Piece.php?startDate="+startDate+"&endDate="+endDate;
			}
			
			$.getJSON(url, function(result) {
				options.series[0].data = result;
				chart = new Highcharts.Chart(options);
			});
		}
		</script>
		
		<!-- Bootstrap core JavaScript
    ================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="js/behaviour/voice-commands.js"></script>
		<script src="js/bootstrap/dist/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/jquery.flot/jquery.flot.js"></script>
		<script type="text/javascript" src="js/jquery.flot/jquery.flot.pie.js"></script>
		<script type="text/javascript"
			src="js/jquery.flot/jquery.flot.resize.js"></script>
		<script type="text/javascript"
			src="js/jquery.flot/jquery.flot.labels.js"></script>
</body>
</html>
